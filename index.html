<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mochkil Arcade 2026</title>
    <style>
        body { 
            margin: 0; background-color: #000; overflow: hidden; 
            touch-action: none; height: 100vh; display: flex; 
            justify-content: center; align-items: center;
        }

        /* The Arcade Cabinet - Base Layer */
        #arcadeContainer {
            position: relative;
            width: 100vw; height: 100vh;
            background: url('arcade.PNG') no-repeat center center;
            background-size: 100% 100%;
            z-index: 1;
        }

        /* The Perfected Virtual Screen */
        #gameScreen {
            position: absolute;
            top: 37%; 
            left: 14%; 
            width: 72%; 
            height: 36%;
            background: #000;
            z-index: 10;
            overflow: hidden;
            border-radius: 2px;
        }

        #gameCanvas { width: 100%; height: 100%; display: block; }

        .ui-top {
            position: absolute; top: 5px; width: 100%; text-align: center;
            color: #0f0; font-family: 'Courier New', monospace; font-size: 12px;
            text-shadow: 1px 1px #000; z-index: 20; pointer-events: none;
        }

        /* Controls positioned on the cabinet dash area */
        .controls {
            position: absolute; bottom: 8%; width: 100%;
            display: flex; justify-content: space-around; z-index: 30;
        }

        button.game-btn {
            font-size: 24px; width: 62px; height: 62px; border-radius: 50%;
            border: 3px solid #0f0; background: rgba(0,0,0,0.9); color: #0f0;
            box-shadow: 0 0 10px #0f0;
        }
        button.game-btn:active { background: #0f0; color: #000; }

        #welcomeScreen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 100;
        }
        
        .menu-btn {
            padding: 12px 25px; margin: 8px; background: #0f0; color: #000; 
            border: none; border-radius: 5px; font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="arcadeContainer">
    <div id="gameScreen">
        <div id="welcomeScreen">
            <h3 style="color:#0f0; margin-bottom:10px;">MOCHKIL 2026</h3>
            <button class="menu-btn" onclick="startGame('mission')">MISSION (500)</button>
            <button class="menu-btn" onclick="startGame('endless')">ENDLESS</button>
        </div>

        <div id="gameUI" class="ui-top" style="display:none;">
            SCORE: <span id="scoreDisplay">0</span> | HI: <span id="hiScoreDisplay">0</span>
            <div style="width:80px; height:4px; border:1px solid #0f0; margin:2px auto;">
                <div id="vibeBar" style="width:50%; height:100%; background:#0f0;"></div>
            </div>
        </div>

        <canvas id="gameCanvas"></canvas>
    </div>

    <div id="controls" class="controls" style="display:none;">
        <button class="game-btn" id="leftBtn">üïπÔ∏è</button>
        <button class="game-btn" id="rightBtn">üïπÔ∏è</button>
        <button class="game-btn" id="eatBtn">üç¥</button>
        <button class="game-btn" id="throwBtn">üöÄ</button>
        <button class="game-btn" id="comaBtn">üí§</button>
    </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const assets = { 
    bg: "IMG_2515.png", idle: "mochkil_idle.png", walk: "mochkil_left.png", 
    eat: "mochkil_eat_left.png", coma: "mochkil_food_coma.png", 
    azul: "https://maximumreality.github.io/WhiskerBytesCatCafe/critic.png" 
};
const images = {};
for(let k in assets) { images[k]=new Image(); images[k].src=assets[k]; }

let gameState = "welcome", gameMode = "", score = 0, vibe = 50;
let hiScore = localStorage.getItem('moch_hi_26') || 0;
document.getElementById("hiScoreDisplay").innerText = hiScore;

let mochkil = { x: 30, y: 0, w: 100, h: 100, state: "idle", facingEast: true };
let azul = { x: 400, y: 20, w: 70, h: 70 }; 
let slices = [], droolDrops = [];

function resize() {
    const rect = document.getElementById("gameScreen").getBoundingClientRect();
    canvas.width = rect.width;
    canvas.height = rect.height;
    mochkil.y = canvas.height - mochkil.h;
    azul.y = canvas.height * 0.1; 
}
window.addEventListener('resize', resize);
setTimeout(resize, 200);

function startGame(mode) {
    gameMode = mode; score = 0; vibe = 50; gameState = "playing";
    document.getElementById("welcomeScreen").style.display = "none";
    document.getElementById("gameUI").style.display = "block";
    document.getElementById("controls").style.display = "flex";
    requestAnimationFrame(gameLoop);
}

function update() {
    if(gameState !== "playing") return;

    // High Score logic (Jan 1, 2026)
    if(score > hiScore) {
        hiScore = score;
        localStorage.setItem('moch_hi_26', hiScore);
        document.getElementById("hiScoreDisplay").innerText = hiScore;
        document.getElementById("scoreDisplay").style.color = "#0f0";
        document.getElementById("scoreDisplay").style.textShadow = "0 0 8px #0f0";
    }

    if (gameMode === "mission" && score >= 500) { alert("üèÜ MISSION COMPLETE!"); location.reload(); }

    azul.x -= 3;
    if (Math.random() > 0.88) droolDrops.push({ x: azul.x + 35, y: azul.y + 50, s: 4 });
    if(azul.x < -100) azul.x = canvas.width + 100;

    droolDrops.forEach((d, i) => {
        d.y += d.s;
        if (d.y > mochkil.y && d.x > mochkil.x && d.x < mochkil.x + mochkil.w) {
            vibe = Math.max(0, vibe - (mochkil.state === "coma" ? 25 : 12));
            droolDrops.splice(i, 1);
        }
    });

    slices.forEach((s, i) => {
        s.x += s.dx; s.y += s.dy; s.dy += 0.8; 
        if(s.x > azul.x && s.x < azul.x + azul.w && s.y > azul.y && s.y < azul.y + azul.h) {
            score += 25; vibe = Math.min(100, vibe + 10);
            azul.x += 140; slices.splice(i, 1);
        }
        if(s.y > canvas.height) slices.splice(i, 1);
    });

    document.getElementById("scoreDisplay").innerText = score;
    document.getElementById("vibeBar").style.width = vibe + "%";
}

function draw() {
    ctx.clearRect(0,0,canvas.width, canvas.height);
    if(images.bg.complete) ctx.drawImage(images.bg, 0, 0, canvas.width, canvas.height);

    ctx.font = "16px serif";
    droolDrops.forEach(d => ctx.fillText("üíß", d.x, d.y));
    ctx.drawImage(images.azul, azul.x, azul.y, azul.w, azul.h);

    let img = images[mochkil.state] || images.idle;
    if(mochkil.facingEast && (mochkil.state === "walk" || mochkil.state === "eat")) {
        ctx.save(); ctx.translate(mochkil.x + mochkil.w, mochkil.y); ctx.scale(-1, 1);
        ctx.drawImage(img, 0, 0, mochkil.w, mochkil.h); ctx.restore();
    } else { ctx.drawImage(img, mochkil.x, mochkil.y, mochkil.w, mochkil.h); }

    slices.forEach(s => { ctx.font = "20px serif"; ctx.fillText("üç∞", s.x, s.y); });
}

// Fixed Plop & Wake logic
const wake = () => { if(mochkil.state === "coma") mochkil.state = "idle"; };
document.getElementById("leftBtn").addEventListener("touchstart", (e) => { e.preventDefault(); wake(); mochkil.x -= 25; mochkil.facingEast = false; mochkil.state = "walk"; });
document.getElementById("rightBtn").addEventListener("touchstart", (e) => { e.preventDefault(); wake(); mochkil.x += 25; mochkil.facingEast = true; mochkil.state = "walk"; });
document.getElementById("eatBtn").addEventListener("touchstart", (e) => { e.preventDefault(); wake(); mochkil.state = "eat"; vibe = Math.min(100, vibe+5); });
document.getElementById("comaBtn").addEventListener("touchstart", (e) => { e.preventDefault(); mochkil.state = "coma"; });
document.getElementById("throwBtn").addEventListener("touchstart", (e) => { 
    e.preventDefault(); if(mochkil.state === "coma") return;
    slices.push({ x: mochkil.x + 50, y: mochkil.y + 20, dx: mochkil.facingEast ? 9 : -9, dy: -22 }); 
});

document.querySelectorAll("button.game-btn").forEach(btn => {
    btn.addEventListener("touchend", () => { if(btn.id !== "comaBtn" && mochkil.state !== "coma") mochkil.state = "idle"; });
});

function gameLoop() { update(); draw(); requestAnimationFrame(gameLoop); }
</script>
</body>
</html>
