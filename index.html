<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mochkil: Kitchen Chaos</title>
    <style>
        body { margin: 0; background-color: #222; overflow: hidden; touch-action: none; height: 100vh; font-family: 'Courier New', monospace; }
        #gameCanvas { display: block; }
        
        /* Screens */
        .overlay-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; flex-direction: column;
            justify-content: center; align-items: center; color: white; z-index: 20;
            text-align: center; padding: 20px; box-sizing: border-box;
        }
        
        .ui-top {
            position: absolute; top: 10px; width: 100%; text-align: center;
            pointer-events: none; color: white; text-shadow: 2px 2px 4px #000; z-index: 10;
        }

        .controls {
            position: absolute; top: 85px; width: 100%;
            display: flex; justify-content: space-around; z-index: 10;
        }

        button.game-btn {
            font-size: 28px; width: 65px; height: 65px; border-radius: 50%;
            border: 3px solid #333; background: #ffcc80; box-shadow: 0 4px #999;
        }

        .menu-btn {
            padding: 15px 30px; margin: 10px; font-size: 20px; font-weight: bold;
            background: #ffcc80; border: none; border-radius: 10px; cursor: pointer;
        }

        #frenzyTimer { color: #ff4444; font-size: 24px; font-weight: bold; display: none; }
    </style>
</head>
<body>

<div id="welcomeScreen" class="overlay-screen">
    <h1 style="color:#ffcc80; font-size: 40px;">MOCHKIL SNACK FRENZY</h1>
    <p>Protect the blue kitchen from Azulzilla!</p>
    <button class="menu-btn" onclick="startGame('mission')">MISSION MODE (Goal: 2500)</button>
    <button class="menu-btn" onclick="startGame('endless')">ENDLESS PLAY</button>
</div>

<div id="endScreen" class="overlay-screen" style="display:none;">
    <h1 id="endTitle">VICTORY!</h1>
    <p id="endStats"></p>
    <button class="menu-btn" onclick="location.reload()">PLAY AGAIN</button>
</div>

<div id="gameUI" class="ui-top" style="display:none;">
    <div id="modeDisplay">Mode: -</div>
    Score: <span id="scoreDisplay">0</span> | High: <span id="hiScoreDisplay">0</span><br>
    Hunger: <span id="meterDisplay">0</span>%
    <div id="frenzyTimer">FRENZY: <span id="seconds">8</span>s</div>
</div>

<canvas id="gameCanvas"></canvas>

<div id="controls" class="controls" style="display:none;">
    <button class="game-btn" id="leftBtn">‚¨ÖÔ∏è</button>
    <button class="game-btn" id="rightBtn">‚û°Ô∏è</button>
    <button class="game-btn" id="eatBtn">üç¥</button>
    <button class="game-btn" id="throwBtn">üéØ</button>
    <button class="game-btn" id="comaBtn">üí§</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// === Assets & Logic ===
let gameState = "welcome"; 
let gameMode = ""; 
let score = 0, snackMeter = 0, isFrenzy = false;
let hiScore = localStorage.getItem('moch_hi_26') || 0;
document.getElementById("hiScoreDisplay").innerText = hiScore;

const assets = {
    bg: "IMG_2515.png",
    idle: "mochkil_idle.png",
    walk: "mochkil_left.png",
    eat: "mochkil_eat_left.png",
    coma: "mochkil_food_coma.png",
    azul: "https://maximumreality.github.io/WhiskerBytesCatCafe/critic.png"
};
const images = {};
let loaded = 0;
for(let k in assets) { images[k]=new Image(); images[k].src=assets[k]; images[k].onload=()=>loaded++; }

let mochkil = { x: 50, y: 0, w: 220, h: 220, state: "idle", facingEast: true };
let azul = { x: 800, y: 0, w: 140, h: 140, speed: 2.5 };
let slices = [];

function resize() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    mochkil.y = canvas.height - mochkil.h;
    azul.y = canvas.height * 0.45;
}
window.addEventListener('resize', resize);
resize();

function startGame(mode) {
    gameMode = mode;
    gameState = "playing";
    document.getElementById("welcomeScreen").style.display = "none";
    document.getElementById("gameUI").style.display = "block";
    document.getElementById("controls").style.display = "flex";
    document.getElementById("modeDisplay").innerText = mode.toUpperCase() + " MODE";
    requestAnimationFrame(gameLoop);
}

function triggerEnd(won) {
    gameState = "ended";
    document.getElementById("gameUI").style.display = "none";
    document.getElementById("controls").style.display = "none";
    const screen = document.getElementById("endScreen");
    screen.style.display = "flex";
    document.getElementById("endTitle").innerText = won ? "MISSION ACCOMPLISHED! üéâ" : "KITCHEN OVERRUN!";
    document.getElementById("endStats").innerText = "Final Score: " + score;
}

function update() {
    if(gameState !== "playing") return;

    // Mission Mode Win Condition
    if(gameMode === "mission" && score >= 2500) triggerEnd(true);

    // Frenzy Check
    if(snackMeter >= 100 && !isFrenzy) {
        isFrenzy = true;
        let time = 8;
        document.getElementById("frenzyTimer").style.display = "block";
        let timer = setInterval(() => {
            time--; document.getElementById("seconds").innerText = time;
            if(time <= 0) { clearInterval(timer); isFrenzy = false; snackMeter = 0; document.getElementById("frenzyTimer").style.display = "none"; }
        }, 1000);
    }

    azul.x -= (isFrenzy ? 8 : 3);
    if(azul.x < -200) {
        azul.x = canvas.width + 100;
        if(score > hiScore) { hiScore = score; localStorage.setItem('moch_hi_26', hiScore); }
    }

    slices.forEach((s, i) => {
        s.x += s.dx;
        if(s.x > azul.x && s.x < azul.x + azul.w && s.y > azul.y && s.y < azul.y + azul.h) {
            score += isFrenzy ? 100 : 25;
            azul.x += 150;
            slices.splice(i, 1);
        }
    });

    document.getElementById("scoreDisplay").innerText = score;
    document.getElementById("meterDisplay").innerText = Math.floor(snackMeter);
}

function draw() {
    ctx.clearRect(0,0,canvas.width, canvas.height);
    if(images.bg.complete) ctx.drawImage(images.bg, 0, 0, canvas.width, canvas.height);

    // Shadow
    ctx.beginPath();
    ctx.ellipse(mochkil.x + 110, canvas.height - 10, 70, 15, 0, 0, Math.PI * 2);
    ctx.fillStyle = "rgba(0, 0, 0, 0.4)"; ctx.fill();

    // Characters
    ctx.save();
    let img = images[mochkil.state] || images.idle;
    if(mochkil.facingEast && mochkil.state !== "idle") {
        ctx.translate(mochkil.x + mochkil.w, mochkil.y); ctx.scale(-1, 1);
        ctx.drawImage(img, 0, 0, mochkil.w, mochkil.h);
    } else { ctx.drawImage(img, mochkil.x, mochkil.y, mochkil.w, mochkil.h); }
    ctx.restore();

    if(isFrenzy) { ctx.shadowBlur = 20; ctx.shadowColor = "red"; }
    ctx.drawImage(images.azul, azul.x, azul.y, azul.w, azul.h);
    ctx.shadowBlur = 0;

    ctx.font = "50px serif";
    slices.forEach(s => ctx.fillText("üç∞", s.x, s.y));
}

// Controls
document.getElementById("leftBtn").addEventListener("touchstart", (e) => { e.preventDefault(); mochkil.x -= 35; mochkil.facingEast = false; mochkil.state = "walk"; });
document.getElementById("rightBtn").addEventListener("touchstart", (e) => { e.preventDefault(); mochkil.x += 35; mochkil.facingEast = true; mochkil.state = "walk"; });
document.getElementById("throwBtn").addEventListener("touchstart", (e) => { e.preventDefault(); slices.push({ x: mochkil.x + 110, y: mochkil.y + 110, dx: mochkil.facingEast ? 15 : -15 }); });
document.getElementById("eatBtn").addEventListener("touchstart", (e) => { e.preventDefault(); mochkil.state = "eat"; snackMeter = Math.min(110, snackMeter + 10); score += 5; });
document.querySelectorAll("button.game-btn").forEach(btn => btn.addEventListener("touchend", () => mochkil.state = "idle"));

function gameLoop() { if(gameState === "playing") { update(); draw(); requestAnimationFrame(gameLoop); } }
</script>
</body>
</html>
